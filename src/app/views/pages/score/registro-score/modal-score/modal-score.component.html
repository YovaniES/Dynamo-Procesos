<div style="display: flex">
  <div class="flex-1"></div>
  <div class="modal-title c-male"> {{DATA_EVENTO ? 'Actualizar' : 'Agregar'}} score </div>
    <div class="flex-1"></div>

    <button (click)="close()" class="icon-btn btn-trans c-orange moda-close-btn">
      <mat-icon>close</mat-icon>
    </button>
</div>

<form class="row g-3" [formGroup]="scoreForm">
  <div class="cli-form newvac-wrapper">
    <div class="chart-draw">

      <!-- DATOS DEL EVENTO ------------------------------------------------------------------------->
      <div class="pr-subtitle mt-2">Datos del Score</div>
      <div class="pr-section mb-3">
        <div class="pr-module-container">
          <div class="row g-2">

            <div class="col-sm-3 cli-form-element" *ngIf="DATA_EVENTO">
              <label>ID Score</label>
              <input
                type="text"
                readonly="true"
                class="form-control cli-input-white"
                formControlName="id_score"/>
            </div>


            <div class="col-sm-3 cli-form-element">
              <label>Estado *</label>
              <select class="cli-input-white" formControlName="id_estado">
                <option [value]="0" disabled>- Seleccione -</option>
                <option [value]="estado.id_correlativo" *ngFor="let estado of listEstado">{{ estado.valor_texto_1 }}</option>
              </select>
              <small class="text-alert" *ngIf="campoNoValido('estado')">* Ingrese el Estado es obligatorio</small>
            </div>


            <div class="col-sm-3 cli-form-element">
              <label>Fecha Envío *</label>
              <input type="date"
                  class="form-control"
                  formControlName="fecha_envio"/>
                  <small class="text-alert" *ngIf="campoNoValido('fecha_envio')">* Ingrese la Fecha es obligatorio</small>
            </div>

            </div>
        </div>
      </div>

      <!-- DETALLES SCORE ------------------------------------------------------------------------->
        <div class="pr-subtitle mt-1">Detalle Score</div>
        <div class="pr-section mb-3">
          <div class="pr-module-container">


            <div class="cli-card">
  <div style="padding: 2px 2px">
    <div>
      <!-- BUSCADOR POR FILTRO ---------------------------------------------------------------->
      <div class="buscar">
          <div class="row g-3" >
            <div class="col-sm-3 cli-form-element">
              <label class="form-label">N° Documento</label>
              <input
                type="text"
                class="form-control"
                placeholder="Ingrese Código"
                formControlName="num_doc"/>
            </div>

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Estado</label>
              <input
                type="text"
                class="form-control"
                placeholder="Ingrese nombre(s)"
                formControlName="id_estado"/>
            </div>

            <div class="col-sm-4 cli-form-element">
              <label class="form-label">Fecha Proceso</label>
              <input
                type="text"
                class="form-control"
                placeholder="Ingrese Apellidos"
                formControlName="fecha_proceso"/>
            </div>

            <div class="col-sm-2">
              <div style="margin-top: 18px; display: flex;">
                <button
                  type="button"
                  matTooltip="Buscar"
                  class="btn-hardware btn-blue-light"
                  style="border-radius: 2px; "
                  (click)="cargarOBuscarScoreDetalle()"
                  ><mat-icon class="icon-18">search</mat-icon>
                 </button>
                 <button
                  type="submit"
                  matTooltip="Limpiar"
                  class="btn-hardware btn-cancel"
                  style="border-radius: 2px;"
                  (click)="limpiarFiltro()"
                ><mat-icon class="icon-18">rotate_left</mat-icon>
                </button>
              </div>
            </div>
          </div>
      </div>

      <!-- BOTON MODAL PARA AGREGAR PEERSONAL ----------------------------------------------------->
      <div style="display: flex">
        <div class="flex-1"></div>
        <div style="color: #345df3;">
          Total : <span class="total">{{ listScoreDetalle.length }} Score detalle</span>
        </div>
      </div>

      <!-- TABLA DE LISTADO PERSONAL ------------------------------------------------------------------>
      <div style="overflow: auto; min-height: 150px">
        <table class="cli-table stripedtable underlinedtable">
          <thead>
            <tr class="bgc-blue-light c-white">
              <!-- <th>Acción</th> -->
              <th>ID Score</th>
              <th>Tipo Doc</th>
              <th>N° Documento</th>
              <th>Segmento</th>
              <th>Score</th>
              <th>Nombres Apell.</th>
              <th>Q_Lineas</th>
              <th>Cód. Financ.</th>
              <th>Estado</th>
              <th>Fecha Proceso</th>
              <th>Solicitante</th>
              <th>Cargo Fijo Máx.</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let score of listScoreDetalle | paginate:
                      { itemsPerPage: pageSize,
                        id:'score',
                        currentPage : page,
                        totalItems  : totalScore
                      } ">
              <!-- <td class="w50">
                <div class="cli-table-actions">
                  <button matTooltip="Actualizar"
                    class="icon-btn btn-trans c-blue"
                    (click)="actualizarScore(score)"
                    ><mat-icon class="icon-13">edit</mat-icon>
                  </button>
                </div>
              </td> -->
              <td class="w150"> {{ score.idscored }}</td>
              <td class="w150"> {{ score.tipo_documento }}</td>
              <td >{{ score.numero_documento }}</td>
              <td>{{ score.segmento }}</td>
              <td class="w100">{{ score.score }}</td>
              <td>{{ score.nombres | uppercase}}</td>
              <td>{{ score.q_lineas }}</td>
              <td>{{ score.codigo_fin }}</td>
              <td>{{ score.estado }}</td>
              <td style="min-width: 95px">{{ score.fecha_proceso }}</td>
              <td class="w100">{{ score.solicitante }}</td>
              <td class="w100">{{ score.cargo_fijo_max   }}</td>
            </tr>
          </tbody>
        </table>

        <div class="cli-loader" *ngIf="loadingItem">
          <mat-spinner style="margin-right: 20px" diameter="20"></mat-spinner>cargando...
        </div>

        <div
          *ngIf="!loadingItem && listScoreDetalle.length == 0"
          class="cli-loader mt-5"
          style="color: #f83434"
          >No hay Score disponible para mostrar
        </div>
      </div>
    </div>

    <div class="card-footer pb-0 pt-3">
      <pagination-controls
        previousLabel="Anterior"
        nextLabel="Siguiente"
        [responsive]="false"
        id="persona"
        (pageChange)="cambiarPagina($event)">
      </pagination-controls>
    </div>
  </div>
</div>
          </div>
        </div>

      <!-- MOTIVOS Y COMENTARIOS ------------------------------------------------------------------------->
        <div class="pr-subtitle mt-1">Motivos - Comentarios</div>
        <div class="pr-section mb-3">
          <div class="pr-module-container">
            <div class="row">
              <div class="col-sm-6 cli-form-element">
                <label>Motivo(notas)</label>
                <textarea
                  class="form-control"
                  style="background-image: none; border-color: #a5a4a4; font-size: 14px;"
                  rows="3"
                  placeholder="Describa algún Motivo del evento"
                  formControlName="motivos">
                </textarea>
              </div>

              <div class="col-sm-6 cli-form-element">
                <label>Comentarios Generales</label>
                <textarea
                  class="form-control"
                  style="background-image: none; border-color: #a5a4a4; font-size: 14px;"
                  rows="3"
                  placeholder="Describa algún Comentario del evento"
                  formControlName="comentarios">
                </textarea>
              </div>
            </div>
          </div>
      </div>

      <!-- HISTORICO DE HARDWARE ------------------------------------------------------------------------->
      <div *ngIf="DATA_EVENTO">
        <!-- <div class="pr-subtitle mt-2">Histórico de cambios</div>
        <div class="pr-section mb-3">
          <div class="pr-module-container">
            <div style="overflow: auto; min-height: 100px; max-height: 160px;">
              <table class="cli-table stripedtable underlinedtable">
                <thead>
                  <tr class="bgc-turquey c-white">
                    <th>#</th>
                    <th>Estado</th>
                    <th>Motivo</th>
                    <th>Fecha y hora</th>
                    <th>Usuario</th>
                  </tr>
                </thead>

                <tbody>
                  <tr *ngFor="let cambios of listHistoricoCambios; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ cambios.estado_evento }}</td>
                    <td>{{ cambios.motivo_evento }}</td>
                    <td class="w300">{{ cambios.fecha_cambio }}</td>
                    <td>{{ cambios.usuario_responsable }}</td>
                  </tr>
                </tbody>
              </table>
              <div class="cli-loader" *ngIf="loadingItem">
                <mat-spinner style="margin-right: 20px" diameter="20"></mat-spinner>cargando...
              </div>

              <div *ngIf="!loadingItem && listHistoricoCambios.length == 0"
                class="cli-loader mt-2"
                style="color: #c9c9c9"
                >Aquí se mostrará el histórico del cambios de Estado del Score...
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>

    <!-- --------------------------------------------BOTONES ------------------------------------------>
    <div class="cli-form-buttons" style="margin-top: 8%">
      <button class="cli-btn btn-m btn-cancel" type="submit" (click)="close()">
        <mat-icon class="icon-18">cancel</mat-icon> Cancelar
      </button>
      <button class="cli-btn btn-m btn-blue"
              (click)="crearOactualizarEvento()"
              [disabled]="scoreForm.invalid"
              ><mat-icon class="icon-18">save</mat-icon> {{actionBtn}}
      </button>
    </div>
  </div>
</form>
